package manager;

import static org.junit.jupiter.api.Assertions.*;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

import ru.yandex.javacourse.exceptions.manager.NotFoundException;
import ru.yandex.javacourse.manager.InMemoryTaskManager;
import ru.yandex.javacourse.manager.Managers;
import ru.yandex.javacourse.tasks.Epic;
import ru.yandex.javacourse.tasks.Status;
import ru.yandex.javacourse.tasks.Subtask;
import ru.yandex.javacourse.tasks.Task;

import java.time.Duration;
import java.time.LocalDateTime;
import java.util.ArrayList;


public class InMemoryTaskManagerTest {
    private InMemoryTaskManager inMemoryTaskManager;

    @BeforeEach
    public void createInMemoryTaskManager() {
        inMemoryTaskManager = (InMemoryTaskManager) Managers.getDefault();
    }

    @Test
    @DisplayName("Проверка на возможность добавления задач различных типов в inMemoryTaskManager и их корректного " +
            "поиска по Id")
    public void thatInMemoryTaskManager_CorrectlyAddsDifferentTaskTypes_And_CanFindThemByIdTest() throws NotFoundException {
        Task task = new Task("Task", "Task description", Status.NEW);
        inMemoryTaskManager.addTask(task);

        Epic epic = new Epic("Epic", "Epic description", new ArrayList<>(), inMemoryTaskManager);
        inMemoryTaskManager.addTask(epic);

        Subtask subtask = new Subtask("Subtask", "Subtask description", Status.NEW, epic.getId());
        inMemoryTaskManager.addTask(subtask);

        assertEquals(task, inMemoryTaskManager.getTask(task.getId()));
        assertEquals(epic, inMemoryTaskManager.getTask(epic.getId()));
        assertEquals(subtask, inMemoryTaskManager.getTask(subtask.getId()));

        assertNotEquals(epic, inMemoryTaskManager.getTask(subtask.getId()));
    }

    @Test
    @DisplayName("Проверка на неконфликтность задач с заданным Id и сгенерированным автоматически")
    public void tasksWithAssignedID_And_AutoGeneratedId_DoNotConflictTest() {
        Task task = new Task("Task", "Task description", Status.NEW);
        inMemoryTaskManager.addTask(task);

        Task task2 = new Task("Task", "Task description", Status.NEW, 14);
        inMemoryTaskManager.addTask(task);

        Task task3 = new Task("Task", "Task description", Status.NEW);
        inMemoryTaskManager.addTask(task);

        assertNotEquals(task, task2);
        assertNotEquals(task2, task3);
    }

    @Test
    @DisplayName("Проверка на неизменяемость задачи при добавлении в inMemoryTaskManager")
    public void equalsOfTask_And_TaskInInMemoryTaskManagerTest() throws NotFoundException {
        Task task = new Task("Task", "Task description", Status.NEW);
        inMemoryTaskManager.addTask(task);

        assertEquals(task, inMemoryTaskManager.getTask(task.getId()));
    }

    @Test
    @DisplayName("Проверка на TimeOverlapConflict в inMemoryTaskManager")
    public void TimeOverlapConflictTest() throws NotFoundException {
        LocalDateTime time = LocalDateTime.now();
        Duration duration = Duration.ofMinutes(45);
        LocalDateTime endTime = time.plus(duration);

        Task task = new Task("Task", "Task description", Status.NEW, duration, time);
        inMemoryTaskManager.addTask(task);

        assertEquals(task, inMemoryTaskManager.getTask(task.getId()));
    }
}